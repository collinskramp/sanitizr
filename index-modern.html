<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AISanitizr - Enterprise Data Sanitization</title>
    <link rel="stylesheet" href="modern-styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Inter', var(--font-sans); 
            background: var(--gray-50);
        }
        
        /* Hero Section - Cleaner Design */
        .hero-section {
            background: linear-gradient(180deg, var(--primary-600) 0%, var(--primary-700) 100%);
            color: white;
            padding: var(--space-16) 0 var(--space-20) 0;
            text-align: center;
            position: relative;
        }
        
        .hero-content { 
            position: relative; 
            z-index: 1; 
            max-width: 800px;
            margin: 0 auto;
            padding: 0 var(--space-6);
        }
        
        .hero-title {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: var(--space-4);
            letter-spacing: -0.02em;
            line-height: 1.2;
        }
        
        .hero-subtitle {
            font-size: 1.125rem;
            opacity: 0.95;
            margin-bottom: var(--space-8);
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.6;
        }
        
        /* Main App Container - Better Spacing */
        .app-container {
            max-width: 1280px;
            margin: 0 auto;
            padding: var(--space-8) var(--space-6) var(--space-12) var(--space-6);
        }
        
        /* Control Panel - Improved Layout */
        .control-panel {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: var(--space-6);
            margin-bottom: var(--space-8);
            padding: var(--space-5);
            flex-wrap: wrap;
        }
        
        .control-options {
            display: flex;
            gap: var(--space-6);
            align-items: center;
            flex-wrap: wrap;
        }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }
        
        .control-label {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--gray-700);
            white-space: nowrap;
        }
        
        .control-actions {
            display: flex;
            gap: var(--space-2);
            align-items: center;
            flex-wrap: wrap;
        }
        
        /* Main Grid Layout - Optimized */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 340px 1fr;
            gap: var(--space-6);
            min-height: 600px;
            align-items: start;
        }
        
        /* Panel Styles - Clean & Focused */
        .panel {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
            transition: all var(--transition-normal);
            height: fit-content;
        }
        
        .panel:hover {
            box-shadow: var(--shadow-md);
            border-color: var(--gray-300);
        }
        
        .panel-header {
            padding: var(--space-5) var(--space-6);
            border-bottom: 1px solid var(--gray-200);
            background: var(--gray-50);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        
        .panel-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--gray-900);
            margin: 0;
            display: flex;
            align-items: center;
            gap: var(--space-2);
            line-height: 1.5;
        }
        
        .panel-subtitle {
            font-size: 0.8125rem;
            color: var(--gray-600);
            margin-top: var(--space-1);
            line-height: 1.5;
        }
        
        .panel-controls {
            display: flex;
            gap: var(--space-2);
            align-items: center;
        }
        
        .panel-content {
            padding: var(--space-6);
            min-height: 500px;
            max-height: 600px;
            overflow: hidden;
            position: relative;
        }
        
        /* Text Areas - Better Typography */
        .modern-textarea {
            width: 100%;
            height: 100%;
            min-height: 450px;
            border: none;
            outline: none;
            background: transparent;
            font-family: var(--font-mono);
            font-size: 0.8125rem;
            line-height: 1.6;
            resize: none;
            color: var(--gray-900);
        }
        
        .modern-textarea::placeholder {
            color: var(--gray-400);
        }
        
        .modern-textarea:focus {
            outline: none;
        }
        
        /* Detection Panel - Scrollable */
        .detection-panel .panel-content {
            overflow-y: auto;
            padding: var(--space-4);
        }
        
        .detection-item {
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
            padding: var(--space-3);
            margin-bottom: var(--space-2);
            transition: all var(--transition-fast);
            cursor: pointer;
        }
        
        .detection-item:hover {
            background: var(--primary-50);
            border-color: var(--primary-300);
        }
        
        .detection-item.selected {
            background: var(--primary-50);
            border-color: var(--primary-500);
            box-shadow: 0 0 0 1px var(--primary-500);
        }
        
        .detection-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-2);
        }
        
        .detection-category {
            font-size: 0.6875rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--primary-600);
            letter-spacing: 0.05em;
        }
        
        .detection-pattern {
            font-family: var(--font-mono);
            font-size: 0.8125rem;
            color: var(--gray-800);
            background: white;
            padding: var(--space-2);
            border-radius: var(--radius-sm);
            margin-bottom: var(--space-2);
            word-break: break-all;
            border: 1px solid var(--gray-200);
        }
        
        .detection-replacement {
            font-family: var(--font-mono);
            font-size: 0.8125rem;
            color: var(--success-600);
            font-weight: 500;
        }
        
        /* Empty State - Centered */
        .empty-state {
            text-align: center;
            padding: var(--space-12) var(--space-6);
            color: var(--gray-500);
        }
        
        .empty-state-icon {
            font-size: 2.5rem;
            margin-bottom: var(--space-3);
            opacity: 0.5;
        }
        
        .empty-state-title {
            font-size: 1rem;
            font-weight: 500;
            color: var(--gray-700);
            margin-bottom: var(--space-2);
        }
        
        .empty-state-description {
            font-size: 0.875rem;
            color: var(--gray-500);
            line-height: 1.5;
        }
        
        /* Status Bar - Compact */
        .status-bar {
            margin-top: var(--space-8);
            padding: var(--space-4) var(--space-6);
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow-sm);
        }
        
        .status-info {
            display: flex;
            gap: var(--space-4);
            align-items: center;
            font-size: 0.8125rem;
            color: var(--gray-600);
        }
        
        .status-actions {
            display: flex;
            gap: var(--space-2);
        }
        
        .btn-link {
            background: none;
            border: none;
            color: var(--primary-600);
            font-size: 0.8125rem;
            font-weight: 500;
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            text-decoration: none;
        }
        
        .btn-link:hover {
            background: var(--primary-50);
            color: var(--primary-700);
        }
        
        /* Responsive Design */
        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
                gap: var(--space-6);
            }
            
            .hero-title {
                font-size: 2.5rem;
            }
        }
        
        @media (max-width: 768px) {
            .control-panel {
                flex-direction: column;
                align-items: stretch;
            }
            
            .control-options {
                flex-direction: column;
                align-items: stretch;
                gap: var(--space-4);
            }
            
            .control-actions {
                justify-content: stretch;
            }
            
            .control-actions button {
                flex: 1;
            }
            
            .app-container {
                padding: var(--space-6) var(--space-4);
            }
            
            .status-bar {
                flex-direction: column;
                gap: var(--space-4);
                text-align: center;
            }
            
            .status-actions {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .hero-title {
                font-size: 2rem;
            }
            
            .hero-subtitle {
                font-size: 1rem;
            }
        }
        
        /* Main App Container */
        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--space-12) var(--space-8);
        }
        
        /* Control Panel - Better Spacing */
        .control-panel {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: var(--space-8);
            align-items: center;
            margin-bottom: var(--space-12);
            padding: var(--space-8);
        }
        
        .control-options {
            display: flex;
            gap: var(--space-8);
            align-items: center;
        }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: var(--space-4);
        }
        
        .control-label {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--gray-700);
            white-space: nowrap;
        }
        
        .control-actions {
            display: flex;
            gap: var(--space-3);
            align-items: center;
        }
        
        /* Main Grid Layout - Better Visual Hierarchy */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 320px 1fr;
            gap: var(--space-8);
            min-height: 600px;
        }
        
        /* Panel Styles - Improved */
        .panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            transition: all var(--transition-normal);
            position: relative;
        }
        
        .panel:hover {
            box-shadow: var(--shadow-xl);
            transform: translateY(-2px);
        }
        
        .panel-header {
            padding: var(--space-8) var(--space-8) var(--space-6) var(--space-8);
            border-bottom: 1px solid var(--gray-100);
            background: rgba(255, 255, 255, 0.7);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        
        .panel-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--gray-900);
            margin: 0;
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }
        
        .panel-subtitle {
            font-size: 0.875rem;
            color: var(--gray-600);
            margin-top: var(--space-2);
        }
        
        .panel-controls {
            display: flex;
            gap: var(--space-2);
            align-items: center;
        }
        
        .panel-content {
            padding: var(--space-8);
            height: 500px;
            overflow: hidden;
            position: relative;
        }
        
        /* Text Areas - Enhanced */
        .modern-textarea {
            width: 100%;
            height: 100%;
            border: none;
            outline: none;
            background: transparent;
            font-family: var(--font-mono);
            font-size: 0.875rem;
            line-height: 1.6;
            resize: none;
            color: var(--gray-900);
        }
        
        .modern-textarea::placeholder {
            color: var(--gray-400);
        }
        
        .modern-textarea:focus {
            outline: none;
        }
        
        /* Detection Panel - Better Empty State */
        .detection-panel .panel-content {
            overflow-y: auto;
            padding: var(--space-6);
        }
        
        .detection-item {
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
            padding: var(--space-4);
            margin-bottom: var(--space-3);
            transition: all var(--transition-fast);
            cursor: pointer;
        }
        
        .detection-item:hover {
            background: var(--primary-50);
            border-color: var(--primary-200);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }
        
        .detection-item.selected {
            background: var(--primary-100);
            border-color: var(--primary-300);
            box-shadow: var(--shadow-sm);
        }
        
        .detection-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-3);
        }
        
        .detection-category {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--primary-600);
            letter-spacing: 0.05em;
        }
        
        .detection-pattern {
            font-family: var(--font-mono);
            font-size: 0.875rem;
            color: var(--gray-800);
            background: rgba(255, 255, 255, 0.8);
            padding: var(--space-3);
            border-radius: var(--radius-sm);
            margin-bottom: var(--space-2);
            word-break: break-all;
        }
        
        .detection-replacement {
            font-family: var(--font-mono);
            font-size: 0.875rem;
            color: var(--success-600);
            font-weight: 500;
        }
        
        /* Empty State - Better Design */
        .empty-state {
            text-align: center;
            padding: var(--space-12) var(--space-6);
            color: var(--gray-500);
        }
        
        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: var(--space-4);
            opacity: 0.6;
        }
        
        .empty-state-title {
            font-size: 1.125rem;
            font-weight: 500;
            color: var(--gray-700);
            margin-bottom: var(--space-2);
        }
        
        .empty-state-description {
            font-size: 0.875rem;
            color: var(--gray-500);
            line-height: 1.5;
        }
        
        /* Status Bar - Enhanced */
        .status-bar {
            margin-top: var(--space-12);
            padding: var(--space-6) var(--space-8);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-xl);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow-md);
        }
        
        .status-info {
            display: flex;
            gap: var(--space-6);
            align-items: center;
            font-size: 0.875rem;
            color: var(--gray-600);
        }
        
        .status-actions {
            display: flex;
            gap: var(--space-2);
        }
        
        .btn-link {
            background: none;
            border: none;
            color: var(--primary-600);
            font-size: 0.875rem;
            font-weight: 500;
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            text-decoration: none;
        }
        
        .btn-link:hover {
            background: var(--primary-50);
            color: var(--primary-700);
        }
        
        /* Responsive Design - Better Breakpoints */
        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
                gap: var(--space-6);
            }
            
            .hero-title {
                font-size: 2.5rem;
            }
            
            .app-container {
                padding: var(--space-8) var(--space-6);
            }
        }
        
        @media (max-width: 768px) {
            .control-panel {
                grid-template-columns: 1fr;
                gap: var(--space-6);
                padding: var(--space-6);
            }
            
            .control-options {
                flex-wrap: wrap;
                gap: var(--space-4);
            }
            
            .control-actions {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .app-container {
                padding: var(--space-6) var(--space-4);
            }
            
            .status-bar {
                flex-direction: column;
                gap: var(--space-4);
                text-align: center;
            }
            
            .status-actions {
                flex-wrap: wrap;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Header -->
    <nav class="nav-header">
        <div class="nav-container">
            <a href="#" class="nav-brand">
                <div class="nav-brand-icon">üõ°Ô∏è</div>
                AISanitizr
            </a>
            <div class="nav-actions">
                <div class="status-indicator status-success">
                    <span>‚óè</span>
                    Bulletproof Engine
                </div>
                <button class="btn btn-secondary btn-sm" id="settings-nav-btn">Settings</button>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="hero-content">
            <h1 class="hero-title animate-fade-in">AISanitizr</h1>
            <p class="hero-subtitle animate-fade-in">
                Enterprise-grade data sanitization for AI workflows. 
                Remove sensitive information before sharing with AI systems or external services.
            </p>
            <div class="animate-fade-in">
                <button class="btn btn-primary btn-lg" id="get-started-btn">
                    üöÄ Get Started
                </button>
                <button class="btn btn-secondary btn-lg" id="learn-more-btn">
                    üìñ Learn More
                </button>
            </div>
        </div>
    </section>

    <!-- Main Application -->
    <div class="app-container">
        <!-- Control Panel -->
        <div class="control-panel card animate-slide-in">
            <div class="control-options">
                <div class="control-group">
                    <label class="control-label">Real-time Processing</label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="real-time-toggle" checked>
                        <span class="toggle-slider"></span>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label">Deterministic Mode</label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="deterministic-toggle" checked>
                        <span class="toggle-slider"></span>
                    </div>
                </div>
                <div class="control-group">
                    <label class="form-label">Profile</label>
                    <select id="profile-select" class="form-select" style="min-width: 120px;">
                        <option value="default">Default</option>
                    </select>
                </div>
            </div>
            <div class="control-actions">
                <div class="tooltip">
                    <button class="btn btn-primary micro-bounce" id="sanitize-btn">
                        üõ°Ô∏è Sanitize
                    </button>
                    <span class="tooltip-text">Sanitize data (‚åòS)</span>
                </div>
                <div class="tooltip">
                    <button class="btn btn-secondary micro-bounce" id="detect-btn">
                        üîç Detect
                    </button>
                    <span class="tooltip-text">Detect patterns (‚åòD)</span>
                </div>
                <button class="btn btn-tertiary" id="clear-btn">üóëÔ∏è Clear</button>
                <button class="btn btn-secondary" id="custom-words-btn">üéØ Custom Words</button>
            </div>
        </div>

        <!-- Main Grid -->
        <div class="main-grid">
            <!-- Input Panel -->
            <div class="panel animate-slide-in">
                <div class="panel-header">
                    <div>
                        <h2 class="panel-title">üìù Input</h2>
                        <p class="panel-subtitle">Paste your sensitive data here</p>
                    </div>
                    <div class="panel-controls">
                        <div class="tooltip">
                            <button class="btn btn-sm btn-secondary" id="paste-btn">üìã</button>
                            <span class="tooltip-text">Paste from clipboard</span>
                        </div>
                        <span class="char-counter" id="input-counter">0 characters</span>
                    </div>
                </div>
                <div class="panel-content">
                    <div class="drop-zone" id="input-drop-zone">
                        <div class="drop-zone-icon">üìÑ</div>
                        <div class="drop-zone-text">Drop files here or click to paste</div>
                    </div>
                    <textarea 
                        id="input-text" 
                        class="modern-textarea" 
                        placeholder="Paste or type text..."
                        spellcheck="false"
                        style="display: none;"
                    ></textarea>
                </div>
            </div>

            <!-- Detection Panel -->
            <div class="panel detection-panel animate-slide-in">
                <div class="panel-header">
                    <div>
                        <h2 class="panel-title">üîç Detections</h2>
                        <p class="panel-subtitle" id="detection-counter">0 patterns found</p>
                    </div>
                    <div class="panel-controls">
                        <button class="btn btn-sm btn-tertiary" id="select-all-btn">All</button>
                        <button class="btn btn-sm btn-tertiary" id="select-none-btn">None</button>
                    </div>
                </div>
                <div class="panel-content">
                    <div id="detections-list" class="detections-list">
                        <div class="empty-state">
                            <div class="empty-state-icon">üîç</div>
                            <div class="empty-state-title">No patterns detected</div>
                            <div class="empty-state-description">
                                Enter data in the input panel to begin analysis
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Output Panel -->
            <div class="panel animate-slide-in">
                <div class="panel-header">
                    <div>
                        <h2 class="panel-title">‚úÖ Output</h2>
                        <p class="panel-subtitle">Safe data ready for sharing</p>
                    </div>
                    <div class="panel-controls">
                        <div class="tooltip">
                            <button class="btn btn-sm btn-secondary copy-button" id="copy-btn">üìÑ</button>
                            <span class="tooltip-text">Copy to clipboard</span>
                        </div>
                        <div class="tooltip">
                            <button class="btn btn-sm btn-secondary" id="export-btn">üíæ</button>
                            <span class="tooltip-text">Export as file</span>
                        </div>
                    </div>
                </div>
                <div class="panel-content">
                    <textarea 
                        id="output-text" 
                        class="modern-textarea" 
                        readonly
                        placeholder="Sanitized output will appear here..."
                    ></textarea>
                </div>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="status-bar animate-fade-in">
            <div class="status-info">
                <span id="processing-status">Ready</span>
                <span>‚Ä¢</span>
                <span id="input-counter">0 characters</span>
                <span>‚Ä¢</span>
                <span id="performance-stats">Cache: 0% hit rate</span>
            </div>
            <div class="status-actions">
                <button class="btn-link" id="manage-rules-btn">üìã Manage Rules</button>
                <button class="btn-link" id="view-history-btn">üìä History</button>
                <button class="btn-link" id="settings-btn">‚öôÔ∏è Settings</button>
                <button class="btn-link" id="export-btn">üíæ Export</button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Progress Indicator -->
    <div id="progress-container" style="position: fixed; top: 0; left: 0; right: 0; z-index: 1000; display: none;">
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="storage.js"></script>
    <script src="sanitizer-engine-bulletproof.js"></script>
    <script>
        // Initialize modern UI
        window.sanitizer = new BulletproofSanitizerEngine();
        
        class ModernUIController {
            constructor() {
                this.elements = {};
                this.state = {
                    currentDetections: [],
                    isProcessing: false,
                    realTimeEnabled: true,
                    deterministicEnabled: true,
                    debounceTimer: null
                };
                
                this.debounceDelay = 300;
                this.initialize();
            }

            initialize() {
                this.cacheElements();
                this.loadSettings();
                this.loadCurrentProfile();
                this.setupEventListeners();
                this.setupAnimations();
                this.showWelcomeMessage();
                
                console.log('üöÄ DataShield Pro Modern UI initialized');
            }

            cacheElements() {
                this.elements = {
                    inputText: document.getElementById('input-text'),
                    outputText: document.getElementById('output-text'),
                    inputDropZone: document.getElementById('input-drop-zone'),
                    realTimeToggle: document.getElementById('real-time-toggle'),
                    deterministicToggle: document.getElementById('deterministic-toggle'),
                    detectBtn: document.getElementById('detect-btn'),
                    sanitizeBtn: document.getElementById('sanitize-btn'),
                    clearBtn: document.getElementById('clear-btn'),
                    customWordsBtn: document.getElementById('custom-words-btn'),
                    detectionsList: document.getElementById('detections-list'),
                    detectionCounter: document.getElementById('detection-counter'),
                    inputCounter: document.getElementById('input-counter'),
                    profileSelect: document.getElementById('profile-select'),
                    processingStatus: document.getElementById('processing-status'),
                    performanceStats: document.getElementById('performance-stats'),
                    manageRulesBtn: document.getElementById('manage-rules-btn'),
                    viewHistoryBtn: document.getElementById('view-history-btn'),
                    settingsBtn: document.getElementById('settings-btn'),
                    exportBtn: document.getElementById('export-btn'),
                    copyBtn: document.getElementById('copy-btn'),
                    pasteBtn: document.getElementById('paste-btn'),
                    selectAllBtn: document.getElementById('select-all-btn'),
                    selectNoneBtn: document.getElementById('select-none-btn'),
                    getStartedBtn: document.getElementById('get-started-btn'),
                    learnMoreBtn: document.getElementById('learn-more-btn'),
                    settingsNavBtn: document.getElementById('settings-nav-btn'),
                    progressContainer: document.getElementById('progress-container'),
                    progressFill: document.getElementById('progress-fill'),
                    toastContainer: document.getElementById('toast-container')
                };
            }

            loadSettings() {
                const settings = window.storage.getSettings();
                this.state.realTimeEnabled = settings.realTimeProcessing;
                this.state.deterministicEnabled = settings.deterministicReplacement;
                this.debounceDelay = settings.debounceDelay;
                this.elements.realTimeToggle.checked = settings.realTimeProcessing;
                this.elements.deterministicToggle.checked = settings.deterministicReplacement;
            }

            loadCurrentProfile() {
                const currentProfileName = window.storage.getCurrentProfile();
                const profiles = window.storage.getProfiles();
                
                this.elements.profileSelect.innerHTML = '';
                Object.keys(profiles).forEach(name => {
                    const option = document.createElement('option');
                    option.value = name;
                    option.textContent = profiles[name].name;
                    if (name === currentProfileName) {
                        option.selected = true;
                    }
                    this.elements.profileSelect.appendChild(option);
                });
                
                const profileData = window.storage.loadProfile(currentProfileName);
                this.currentRules = profileData ? profileData.rules : window.storage.getRules();
            }

            setupEventListeners() {
                // Input handling with drag & drop
                this.setupDragAndDrop();
                
                this.elements.inputText.addEventListener('input', (e) => {
                    this.handleInputChange(e.target.value);
                });

                // Control toggles
                this.elements.realTimeToggle.addEventListener('change', (e) => {
                    this.state.realTimeEnabled = e.target.checked;
                    this.saveCurrentSettings();
                    if (e.target.checked && this.elements.inputText.value) {
                        this.handleInputChange(this.elements.inputText.value);
                    }
                });

                this.elements.deterministicToggle.addEventListener('change', (e) => {
                    this.state.deterministicEnabled = e.target.checked;
                    this.saveCurrentSettings();
                });

                // Action buttons with loading states
                this.elements.detectBtn.addEventListener('click', () => {
                    this.performDetection(this.elements.inputText.value);
                });

                this.elements.sanitizeBtn.addEventListener('click', () => {
                    this.performSanitization(this.elements.inputText.value);
                });

                this.elements.clearBtn.addEventListener('click', () => {
                    this.clearAll();
                });

                this.elements.customWordsBtn.addEventListener('click', () => {
                    window.open('custom-words-settings.html', '_blank');
                });

                // Panel controls
                this.elements.pasteBtn.addEventListener('click', async () => {
                    await this.pasteFromClipboard();
                });

                this.elements.copyBtn.addEventListener('click', async () => {
                    await this.copyToClipboard();
                });

                this.elements.selectAllBtn.addEventListener('click', () => {
                    this.selectAllDetections(true);
                });

                this.elements.selectNoneBtn.addEventListener('click', () => {
                    this.selectAllDetections(false);
                });

                // Navigation buttons
                this.elements.manageRulesBtn.addEventListener('click', () => {
                    window.open('manage-rules.html', '_blank');
                });

                this.elements.viewHistoryBtn.addEventListener('click', () => {
                    window.open('view-history.html', '_blank');
                });

                this.elements.settingsBtn.addEventListener('click', () => {
                    window.open('settings.html', '_blank');
                });

                this.elements.settingsNavBtn.addEventListener('click', () => {
                    window.open('settings.html', '_blank');
                });

                this.elements.exportBtn.addEventListener('click', () => {
                    this.exportOutput();
                });

                // Hero buttons
                this.elements.getStartedBtn.addEventListener('click', () => {
                    document.querySelector('.app-container').scrollIntoView({ 
                        behavior: 'smooth' 
                    });
                    this.showInputArea();
                    setTimeout(() => this.elements.inputText.focus(), 500);
                });

                this.elements.learnMoreBtn.addEventListener('click', () => {
                    window.open('https://github.com/your-repo/aisanitizr', '_blank');
                });

                // Profile selection
                this.elements.profileSelect.addEventListener('change', (e) => {
                    this.switchProfile(e.target.value);
                });

                // Enhanced keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey || e.metaKey) {
                        switch (e.key) {
                            case 'Enter':
                            case 's':
                                e.preventDefault();
                                this.performSanitization(this.elements.inputText.value);
                                break;
                            case 'd':
                                e.preventDefault();
                                this.performDetection(this.elements.inputText.value);
                                break;
                            case 'k':
                                e.preventDefault();
                                this.clearAll();
                                break;
                        }
                    }
                });
            }

            setupAnimations() {
                // Intersection Observer for scroll animations
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.style.animationDelay = '0ms';
                            entry.target.classList.add('animate-fade-in');
                        }
                    });
                });

                document.querySelectorAll('.panel').forEach(panel => {
                    observer.observe(panel);
                });
            }

            handleInputChange(text) {
                this.updateCharacterCount(text);
                
                if (this.state.debounceTimer) {
                    clearTimeout(this.state.debounceTimer);
                }
                
                if (this.state.realTimeEnabled && text.trim()) {
                    this.state.debounceTimer = setTimeout(() => {
                        this.performDetection(text);
                    }, this.debounceDelay);
                } else if (!text.trim()) {
                    this.state.currentDetections = [];
                    this.updateDetectionPanel([]);
                    this.elements.outputText.value = '';
                }
            }

            performDetection(text) {
                if (!text || this.state.isProcessing) return;
                
                const removeLoading = this.addLoadingState(this.elements.detectBtn);
                this.showProgress(true);
                this.state.isProcessing = true;
                this.updateProcessingStatus('üîç Detecting patterns...');
                
                try {
                    const startTime = Date.now();
                    
                    const detections = window.sanitizer.detectSafe(text, {
                        rules: this.currentRules,
                        includeContext: true,
                        contextLength: 20
                    });
                    
                    const processingTime = Date.now() - startTime;
                    
                    this.state.currentDetections = detections;
                    this.updateDetectionPanel(detections);
                    
                    this.updateProcessingStatus(`‚úÖ Found ${detections.length} patterns (${processingTime}ms)`);
                    
                    if (detections.length > 0) {
                        this.showToast(`Found ${detections.length} sensitive patterns`, 'info');
                    }
                    
                    if (this.state.realTimeEnabled) {
                        setTimeout(() => {
                            this.performSanitization(text, false);
                        }, 100);
                    }
                    
                } catch (error) {
                    console.error('Detection failed:', error);
                    this.updateProcessingStatus('‚ùå Detection failed');
                    this.showToast('Pattern detection failed', 'error');
                } finally {
                    this.state.isProcessing = false;
                    this.showProgress(false);
                    removeLoading();
                }
            }

            performSanitization(text, addToHistory = true) {
                if (!text || this.state.isProcessing) return;
                
                const removeLoading = this.addLoadingState(this.elements.sanitizeBtn);
                this.showProgress(true);
                this.state.isProcessing = true;
                this.updateProcessingStatus('üõ°Ô∏è Sanitizing data...');
                
                try {
                    const startTime = Date.now();
                    
                    const selectedDetections = this.state.currentDetections
                        .filter(d => d.selected)
                        .map(d => d.ruleId);
                    
                    const sanitizedText = window.sanitizer.sanitize(text, {
                        rules: this.currentRules,
                        deterministicReplacement: this.state.deterministicEnabled,
                        selectedDetections: selectedDetections.length > 0 ? selectedDetections : null
                    });
                    
                    const processingTime = Date.now() - startTime;
                    
                    this.elements.outputText.value = sanitizedText;
                    
                    this.updateProcessingStatus(`‚úÖ Sanitized in ${processingTime}ms`);
                    
                    const replacements = this.state.currentDetections.filter(d => d.selected).length;
                    this.showToast(`Data sanitized with ${replacements} replacements`, 'success');
                    
                    if (addToHistory) {
                        this.addToHistory(text, sanitizedText);
                    }
                    
                } catch (error) {
                    console.error('Sanitization failed:', error);
                    this.updateProcessingStatus('‚ùå Sanitization failed');
                    this.showToast('Sanitization failed', 'error');
                } finally {
                    this.state.isProcessing = false;
                    this.showProgress(false);
                    removeLoading();
                }
            }

            updateDetectionPanel(detections) {
                this.elements.detectionCounter.textContent = `${detections.length} patterns found`;
                
                if (detections.length === 0) {
                    this.elements.detectionsList.innerHTML = `
                        <div class="no-detections" style="text-align: center; color: var(--gray-500); padding: var(--space-8);">
                            <div style="font-size: 2rem; margin-bottom: var(--space-4);">üîç</div>
                            <p>No sensitive patterns detected</p>
                            <p style="font-size: 0.875rem; margin-top: var(--space-2);">
                                Enter data in the input panel to begin analysis
                            </p>
                        </div>
                    `;
                    return;
                }
                
                let html = '';
                detections.forEach((detection, index) => {
                    html += `
                        <div class="detection-item ${detection.selected ? 'selected' : ''}" 
                             data-detection-id="${detection.ruleId}-${index}">
                            <div class="detection-header">
                                <span class="detection-category">${detection.category}</span>
                                <input type="checkbox" class="detection-checkbox" 
                                       ${detection.selected ? 'checked' : ''}>
                            </div>
                            <div class="detection-pattern">${this.escapeHtml(detection.match)}</div>
                            <div class="detection-replacement">
                                ‚Üí ${this.escapeHtml(detection.replacement)}
                            </div>
                        </div>
                    `;
                });
                
                this.elements.detectionsList.innerHTML = html;
                
                // Add event listeners
                this.elements.detectionsList.querySelectorAll('.detection-item').forEach(item => {
                    const checkbox = item.querySelector('.detection-checkbox');
                    const detectionId = item.dataset.detectionId;
                    
                    const toggleSelection = () => {
                        const detection = this.findDetectionById(detectionId);
                        if (detection) {
                            detection.selected = !detection.selected;
                            item.classList.toggle('selected', detection.selected);
                            checkbox.checked = detection.selected;
                        }
                    };
                    
                    item.addEventListener('click', (e) => {
                        if (e.target !== checkbox) {
                            toggleSelection();
                        }
                    });
                    
                    checkbox.addEventListener('change', toggleSelection);
                });
            }

            showProgress(show) {
                if (show) {
                    this.elements.progressContainer.style.display = 'block';
                    this.elements.progressFill.style.width = '100%';
                } else {
                    setTimeout(() => {
                        this.elements.progressContainer.style.display = 'none';
                        this.elements.progressFill.style.width = '0%';
                    }, 500);
                }
            }

            updateProcessingStatus(status) {
                this.elements.processingStatus.textContent = status;
                
                const metrics = window.sanitizer.getPerformanceMetrics();
                this.elements.performanceStats.textContent = 
                    `Cache: ${(metrics.cacheHitRate * 100).toFixed(0)}% hit rate`;
            }

            clearAll() {
                this.elements.inputText.value = '';
                this.elements.outputText.value = '';
                this.state.currentDetections = [];
                this.updateDetectionPanel([]);
                this.elements.inputCounter.textContent = '0 characters';
                this.updateProcessingStatus('Ready');
            }

            switchProfile(profileName) {
                const profileData = window.storage.loadProfile(profileName);
                if (profileData) {
                    this.currentRules = profileData.rules;
                    window.storage.setCurrentProfile(profileName);
                    
                    const inputText = this.elements.inputText.value;
                    if (inputText.trim()) {
                        this.performDetection(inputText);
                    }
                }
            }

            saveCurrentSettings() {
                const settings = window.storage.getSettings();
                settings.realTimeProcessing = this.state.realTimeEnabled;
                settings.deterministicReplacement = this.state.deterministicEnabled;
                window.storage.saveSettings(settings);
            }

            addToHistory(input, output) {
                const historyEntry = {
                    timestamp: new Date(),
                    originalText: input,
                    sanitizedText: output,
                    inputPreview: input.substring(0, 100),
                    outputPreview: output.substring(0, 100),
                    detections: this.state.currentDetections.map(d => ({
                        ruleId: d.ruleId,
                        ruleName: d.ruleName,
                        category: d.category,
                        pattern: d.pattern,
                        match: d.match,
                        selected: d.selected
                    })),
                    detectionsCount: this.state.currentDetections.length,
                    profileName: window.storage.getCurrentProfile(),
                    inputSize: input.length,
                    outputSize: output.length
                };
                
                window.storage.addHistoryEntry(historyEntry);
            }

            exportOutput() {
                const output = this.elements.outputText.value;
                if (!output) return;
                
                const blob = new Blob([output], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `sanitized-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            findDetectionById(detectionId) {
                const [ruleId, index] = detectionId.split('-');
                return this.state.currentDetections.find((d, i) => 
                    d.ruleId === ruleId && i === parseInt(index)
                );
            }

            showWelcomeMessage() {
                console.log('üöÄ Welcome to AISanitizr - Modern Enterprise UI');
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            // Modern UI Methods
            setupDragAndDrop() {
                const dropZone = this.elements.inputDropZone;
                const textarea = this.elements.inputText;

                // Show drop zone initially, hide textarea
                dropZone.style.display = 'flex';
                textarea.style.display = 'none';

                // Click to activate input
                dropZone.addEventListener('click', () => {
                    this.showInputArea();
                });

                // Drag and drop events
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    dropZone.addEventListener(eventName, this.preventDefaults, false);
                });

                ['dragenter', 'dragover'].forEach(eventName => {
                    dropZone.addEventListener(eventName, () => {
                        dropZone.classList.add('drag-over');
                    }, false);
                });

                ['dragleave', 'drop'].forEach(eventName => {
                    dropZone.addEventListener(eventName, () => {
                        dropZone.classList.remove('drag-over');
                    }, false);
                });

                dropZone.addEventListener('drop', (e) => {
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        this.handleFileUpload(files[0]);
                    }
                }, false);
            }

            preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            showInputArea() {
                this.elements.inputDropZone.style.display = 'none';
                this.elements.inputText.style.display = 'block';
                this.elements.inputText.focus();
            }

            async handleFileUpload(file) {
                if (file.type === 'text/plain' || file.type === 'application/json') {
                    try {
                        const text = await file.text();
                        this.showInputArea();
                        this.elements.inputText.value = text;
                        this.handleInputChange(text);
                        this.showToast('File loaded successfully', 'success');
                    } catch (error) {
                        this.showToast('Failed to read file', 'error');
                    }
                } else {
                    this.showToast('Please upload a text or JSON file', 'warning');
                }
            }

            async pasteFromClipboard() {
                try {
                    const text = await navigator.clipboard.readText();
                    if (text) {
                        this.showInputArea();
                        this.elements.inputText.value = text;
                        this.handleInputChange(text);
                        this.showToast('Pasted from clipboard', 'success');
                    }
                } catch (error) {
                    this.showToast('Failed to paste from clipboard', 'error');
                }
            }

            async copyToClipboard() {
                const output = this.elements.outputText.value;
                if (!output) {
                    this.showToast('No output to copy', 'warning');
                    return;
                }

                try {
                    await navigator.clipboard.writeText(output);
                    
                    // Add visual feedback to copy button
                    this.elements.copyBtn.classList.add('copied');
                    setTimeout(() => {
                        this.elements.copyBtn.classList.remove('copied');
                    }, 1500);
                    
                    this.showToast('Copied to clipboard', 'success');
                } catch (error) {
                    this.showToast('Failed to copy to clipboard', 'error');
                }
            }

            showToast(message, type = 'info', duration = 3000) {
                const toast = document.createElement('div');
                toast.className = `toast toast-${type}`;
                
                const icon = {
                    success: '‚úÖ',
                    error: '‚ùå',
                    warning: '‚ö†Ô∏è',
                    info: '‚ÑπÔ∏è'
                }[type] || '‚ÑπÔ∏è';
                
                toast.innerHTML = `
                    <span>${icon}</span>
                    <span>${message}</span>
                `;
                
                this.elements.toastContainer.appendChild(toast);
                
                setTimeout(() => {
                    toast.style.animation = 'toast-slide-out 0.3s ease-in forwards';
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.parentNode.removeChild(toast);
                        }
                    }, 300);
                }, duration);
            }

            updateCharacterCount(text) {
                const count = text.length;
                const counter = this.elements.inputCounter;
                
                counter.textContent = `${count.toLocaleString()} characters`;
                
                // Add warning colors for large inputs
                counter.className = 'char-counter';
                if (count > 50000) {
                    counter.classList.add('danger');
                } else if (count > 25000) {
                    counter.classList.add('warning');
                }
            }

            selectAllDetections(selected) {
                this.state.currentDetections.forEach(detection => {
                    detection.selected = selected;
                });
                this.updateDetectionPanel(this.state.currentDetections);
                
                const message = selected ? 'All patterns selected' : 'All patterns deselected';
                this.showToast(message, 'info', 1500);
            }

            addLoadingState(element) {
                const originalContent = element.innerHTML;
                element.innerHTML = '<span class="loading-spinner"></span> Processing...';
                element.disabled = true;
                
                return () => {
                    element.innerHTML = originalContent;
                    element.disabled = false;
                };
            }
        }

        // Initialize modern application
        window.app = new ModernUIController();
    </script>
</body>
</html>